# AetherNet 校园互助平台接口文档

## 1. 数据库表完善设计

基于系统设计说明书中的数据库设计，进一步完善各表结构如下：

### 1.1 用户表（tb_users）

| 字段名     | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                             |
| ---------- | ------------ | -------- | -------- | ----------------- | -------------------------------- |
| user_id    | BIGINT       | 是       | 否       | 自增              | 用户唯一标识符                   |
| username   | VARCHAR(50)  | 否       | 否       | 无                | 用户名，用于登录和显示           |
| password   | VARCHAR(255) | 否       | 否       | 无                | 密码哈希值，采用安全加密算法存储 |
| email      | VARCHAR(100) | 否       | 是       | 无                | 邮箱地址，用于账户验证和联系     |
| student_id | VARCHAR(20)  | 否       | 是       | 无                | 学号，用于验证学生身份           |
| role       | VARCHAR(20)  | 否       | 否       | 'student'         | 用户角色，区分普通学生和管理员   |
| avatar_url | VARCHAR(255) | 否       | 是       | 无                | 用户头像图片链接                 |
| phone      | VARCHAR(20)  | 否       |          | 无                | 手机号码，用于联系和验证         |
| status     | TINYINT      | 否       | 否       | 1                 | 用户状态，1表示正常，0表示禁用   |
| created_at | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 用户注册时间                     |
| updated_at | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 用户信息最后更新时间             |

> 注意：[student_id](file:///D:/02_study/code/JavaProject/AetherNet/student_id) 字段具有唯一约束，用于确保一个学号只能注册一个账户。

### 1.2 帖子表（tb_posts）

| 字段名        | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                                                         |
| ------------- | ------------ | -------- | -------- | ----------------- | ------------------------------------------------------------ |
| post_id       | BIGINT       | 是       | 否       | 自增              | 帖子唯一标识符                                               |
| title         | VARCHAR(100) | 否       | 否       | 无                | 帖子标题，简要概括内容                                       |
| content       | TEXT         | 否       | 否       | 无                | 帖子正文内容                                                 |
| user_id       | BIGINT       | 否       | 否       | 无                | 发布者用户ID，关联用户表                                     |
| category_id   | BIGINT       | 否       | 否       | 无                | 帖子分类ID，关联分类表                                       |
| status        | VARCHAR(20)  | 否       | 否       | 'pending'         | 帖子状态：'pending'(待审核)、'approved'(已通过)、'rejected'(已拒绝)、'deleted'(已删除) |
| view_count    | INT          | 否       | 否       | 0                 | 帖子浏览次数统计                                             |
| like_count    | INT          | 否       | 否       | 0                 | 帖子点赞数统计                                               |
| comment_count | INT          | 否       | 否       | 0                 | 帖子评论数统计                                               |
| is_anonymous  | TINYINT      | 否       | 否       | 0                 | 是否匿名发布，0表示否，1表示是                               |
| is_top        | TINYINT      | 否       | 否       | 0                 | 是否置顶，0表示否，1表示是                                   |
| is_featured   | TINYINT      | 否       | 否       | 0                 | 是否精华帖，0表示否，1表示是                                 |
| location      | VARCHAR(100) | 否       | 是       | NULL              | 地理位置信息                                                 |
| contact_info  | VARCHAR(100) | 否       | 是       | NULL              | 联系方式                                                     |
| ip_address    | VARCHAR(45)  | 否       | 是       | NULL              | 发布者IP地址                                                 |
| created_at    | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 帖子发布时间                                                 |
| updated_at    | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 帖子最后更新时间                                             |
| updated_by    | BIGINT       | 否       | 是       | NULL              | 最后更新者ID，关联用户表                                     |

### 1.3 任务表（tb_tasks）

| 字段名       | 类型          | 是否主键 | 是否为空 | 默认值            | 说明                                                         |
| ------------ | ------------- | -------- | -------- | ----------------- | ------------------------------------------------------------ |
| task_id      | BIGINT        | 是       | 否       | 自增              | 任务唯一标识符                                               |
| title        | VARCHAR(100)  | 否       | 否       | 无                | 任务标题，简要说明任务内容                                   |
| description  | TEXT          | 否       | 否       | 无                | 任务详细描述                                                 |
| publisher_id | BIGINT        | 否       | 否       | 无                | 任务发布者ID，关联用户表                                     |
| assignee_id  | BIGINT        | 否       | 是       | NULL              | 任务接单者ID，关联用户表                                     |
| reward       | DECIMAL(10,2) | 否       | 是       | NULL              | 任务酬劳金额，单位为元                                       |
| status       | VARCHAR(20)   | 否       | 否       | 'open'            | 任务状态：'open'(开放中)、'in_progress'(进行中)、'completed'(已完成)、'cancelled'(已取消) |
| deadline     | DATETIME      | 否       | 是       | NULL              | 任务截止时间                                                 |
| location     | VARCHAR(100)  | 否       | 是       | NULL              | 任务地点                                                     |
| contact_info | VARCHAR(100)  | 否       | 是       | NULL              | 联系方式                                                     |
| completed_at | DATETIME      | 否       | 是       | NULL              | 任务实际完成时间                                             |
| created_at   | DATETIME      | 否       | 否       | CURRENT_TIMESTAMP | 任务创建时间                                                 |
| updated_at   | DATETIME      | 否       | 否       | CURRENT_TIMESTAMP | 任务最后更新时间                                             |

### 1.4 评论表（tb_comments）

| 字段名      | 类型        | 是否主键 | 是否为空 | 默认值            | 说明                               |
| ----------- | ----------- | -------- | -------- | ----------------- | ---------------------------------- |
| comment_id  | BIGINT      | 是       | 否       | 自增              | 评论唯一标识符                     |
| post_id     | BIGINT      | 否       | 否       | 无                | 所属帖子ID，关联帖子表             |
| user_id     | BIGINT      | 否       | 否       | 无                | 评论者用户ID，关联用户表           |
| parent_id   | BIGINT      | 否       | 是       | NULL              | 父级评论ID，用于构建评论回复树结构 |
| content     | TEXT        | 否       | 否       | 无                | 评论内容                           |
| status      | TINYINT     | 否       | 否       | 1                 | 评论状态，1表示正常，0表示已删除   |
| like_count  | INT         | 否       | 否       | 0                 | 评论点赞数统计                     |
| reply_count | INT         | 否       | 否       | 0                 | 直接回复该评论的数量统计           |
| ip_address  | VARCHAR(45) | 否       | 是       | NULL              | 评论者IP地址                       |
| created_at  | DATETIME    | 否       | 否       | CURRENT_TIMESTAMP | 评论发布时间                       |

### 1.5 标签表（tb_tags）

| 字段名     | 类型        | 是否主键 | 是否为空 | 默认值            | 说明                                 |
| ---------- | ----------- | -------- | -------- | ----------------- | ------------------------------------ |
| tag_id     | BIGINT      | 是       | 否       | 自增              | 标签唯一标识符                       |
| tag_name   | VARCHAR(30) | 否       | 否       | 无                | 标签名称，如"二手书籍"、"代取快递"等 |
| post_count | INT         | 否       | 否       | 0                 | 使用该标签的帖子数量统计             |
| created_at | DATETIME    | 否       | 否       | CURRENT_TIMESTAMP | 标签创建时间                         |

### 1.6 帖子标签关联表（tb_post_tags）

| 字段名  | 类型   | 是否主键 | 是否为空 | 默认值 | 说明               |
| ------- | ------ | -------- | -------- | ------ | ------------------ |
| post_id | BIGINT | 是       | 否       | 无     | 帖子ID，关联帖子表 |
| tag_id  | BIGINT | 是       | 否       | 无     | 标签ID，关联标签表 |

### 1.7 审核日志表（tb_moderation_logs）

| 字段名       | 类型        | 是否主键 | 是否为空 | 默认值            | 说明                                                         |
| ------------ | ----------- | -------- | -------- | ----------------- | ------------------------------------------------------------ |
| log_id       | BIGINT      | 是       | 否       | 自增              | 审核日志唯一标识符                                           |
| post_id      | BIGINT      | 否       | 否       | 无                | 被审核的帖子ID，关联帖子表                                   |
| moderator_id | BIGINT      | 否       | 是       | NULL              | 审核员ID，关联用户表（若为系统自动审核则为空）               |
| decision     | VARCHAR(20) | 否       | 否       | 无                | 审核决定：'approved'(通过) 或 'rejected'(拒绝)               |
| risk_level   | VARCHAR(10) | 否       | 否       | 'low'             | 风险等级评估：'low'(低风险)、'medium'(中风险)、'high'(高风险) |
| reason       | TEXT        | 否       | 是       | NULL              | 审核理由或备注信息                                           |
| created_at   | DATETIME    | 否       | 否       | CURRENT_TIMESTAMP | 审核执行时间                                                 |

> 注意：审核日志表中的 [decision](file:///D:/02_study/code/JavaProject/AetherNet/decision) 和 [risk_level](file:///D:/02_study/code/JavaProject/AetherNet/risk_level) 字段在数据库中存储为字符串类型，以提高数据的可读性和维护性。

### 1.8 点赞表（tb_likes）

| 字段名     | 类型     | 是否主键 | 是否为空 | 默认值            | 说明                     |
| ---------- | -------- | -------- | -------- | ----------------- | ------------------------ |
| like_id    | BIGINT   | 是       | 否       | 自增              | 点赞记录唯一标识符       |
| user_id    | BIGINT   | 否       | 否       | 无                | 点赞用户ID，关联用户表   |
| post_id    | BIGINT   | 否       | 是       | NULL              | 被点赞帖子ID，关联帖子表 |
| comment_id | BIGINT   | 否       | 是       | NULL              | 被点赞评论ID，关联评论表 |
| created_at | DATETIME | 否       | 否       | CURRENT_TIMESTAMP | 点赞时间                 |

> 注意：为保证数据一致性，同一时间只能对一个实体进行点赞，即[post_id](file:///D:/02_study/code/JavaProject/AetherNet/post_id)和[comment_id](file:///D:/02_study/code/JavaProject/AetherNet/comment_id)不能同时为空，也不能同时有值。

### 1.9 帖子图片表（tb_post_images）

| 字段名     | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                   |
| ---------- | ------------ | -------- | -------- | ----------------- | ---------------------- |
| image_id   | BIGINT       | 是       | 否       | 自增              | 图片唯一标识符         |
| post_id    | BIGINT       | 否       | 否       | 无                | 所属帖子ID，关联帖子表 |
| image_url  | VARCHAR(255) | 否       | 否       | 无                | 图片链接地址           |
| sort_order | INT          | 否       | 否       | 0                 | 图片排序序号           |
| created_at | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 图片上传时间           |

### 1.10 分类表（tb_categories）

| 字段名        | 类型        | 是否主键 | 是否为空 | 默认值            | 说明           |
| ------------- | ----------- | -------- | -------- | ----------------- | -------------- |
| category_id   | BIGINT      | 是       | 否       | 自增              | 分类唯一标识符 |
| category_name | VARCHAR(50) | 否       | 否       | 无                | 分类名称       |
| category_code | VARCHAR(20) | 否       | 否       | 无                | 分类代码       |
| sort_order    | INT         | 否       | 否       | 0                 | 排序序号       |
| created_at    | DATETIME    | 否       | 否       | CURRENT_TIMESTAMP | 创建时间       |

### 1.11 收藏表（tb_favorites）

| 字段名      | 类型     | 是否主键 | 是否为空 | 默认值            | 说明                     |
| ----------- | -------- | -------- | -------- | ----------------- | ------------------------ |
| favorite_id | BIGINT   | 是       | 否       | 自增              | 收藏记录唯一标识符       |
| user_id     | BIGINT   | 否       | 否       | 无                | 收藏用户ID，关联用户表   |
| post_id     | BIGINT   | 否       | 否       | 无                | 被收藏帖子ID，关联帖子表 |
| created_at  | DATETIME | 否       | 否       | CURRENT_TIMESTAMP | 收藏时间                 |

### 1.12 举报表（tb_reports）

| 字段名      | 类型         | 是否主键 | 是否为空 | 默认值            | 说明                                                         |
| ----------- | ------------ | -------- | -------- | ----------------- | ------------------------------------------------------------ |
| report_id   | BIGINT       | 是       | 否       | 自增              | 举报记录唯一标识符                                           |
| reporter_id | BIGINT       | 否       | 否       | 无                | 举报用户ID，关联用户表                                       |
| post_id     | BIGINT       | 否       | 是       | NULL              | 被举报帖子ID，关联帖子表                                     |
| comment_id  | BIGINT       | 否       | 是       | NULL              | 被举报评论ID，关联评论表                                     |
| reason      | VARCHAR(255) | 否       | 否       | 无                | 举报原因                                                     |
| status      | VARCHAR(20)  | 否       | 否       | 'pending'         | 举报状态：'pending'(待处理)、'processed'(已处理)、'dismissed'(已驳回) |
| handled_by  | BIGINT       | 否       | 是       | NULL              | 处理人ID，关联用户表（管理员）                               |
| handled_at  | DATETIME     | 否       | 是       | NULL              | 处理时间                                                     |
| created_at  | DATETIME     | 否       | 否       | CURRENT_TIMESTAMP | 举报时间                                                     |

## 2. 接口规范

### 2.1 统一响应格式

所有接口返回的数据格式遵循统一的JSON结构：

#### 成功响应：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1623456789000
}
```

#### 错误响应：

```json
{
  "code": 400,
  "message": "错误描述",
  "data": null,
  "timestamp": 1623456789000
}
```

#### 字段说明：

- `code`: 响应状态码，表示请求处理的结果
- `message`: 响应消息，对处理结果的文本描述
- `data`: 响应数据，包含具体的数据内容
- `timestamp`: 响应时间戳，表示服务器生成响应的时间，采用毫秒时间戳格式

### 2.2 统一分页响应格式

对于返回列表数据的接口，采用统一的分页响应格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "currentPage": 1,
    "pageSize": 10,
    "total": 100,
    "totalPages": 10,
    "records": [],
    "hasPrevious": false,
    "hasNext": true
  },
  "timestamp": 1623456789000
}
```

#### 字段说明：

- `currentPage`: 当前页码
- `pageSize`: 每页条数
- `total`: 总记录数
- `totalPages`: 总页数
- `records`: 当前页的数据列表
- `hasPrevious`: 是否有上一页
- `hasNext`: 是否有下一页
- `timestamp`: 响应时间戳，表示服务器生成响应的时间，采用毫秒时间戳格式

### 2.3 响应码定义

| 响应码 | 说明            |
| ------ | --------------- |
| 200    | 请求成功        |
| 400    | 请求参数错误    |
| 401    | 未授权/登录失效 |
| 403    | 权限不足        |
| 404    | 资源不存在      |
| 500    | 服务器内部错误  |

### 2.4 接口前缀约定

- 管理员接口前缀：`/api/admin`
- 学生端接口前缀：`/api/student`
- 公共接口前缀：`/api/public`

## 3. 接口设计

### 3.1 公共接口（/api/public）

#### 3.1.1 用户认证相关接口

##### 用户注册

- 接口路径：`POST /api/public/register`

- 请求参数：

  ```json
  {
    "studentId": "学号",
    "password": "密码",
    "phone": "手机号",
    "role": "用户角色(student/admin)"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "注册成功",
    "data": {
      "userId": 1,
      "studentId": "20210001",
      "phone": "13800138000"
    },
    "timestamp": 1623456789000
  }
  ```

##### 用户登录

- 接口路径：`POST /api/public/login`

- 请求参数：

  ```json
  {
    "studentId": "学号",
    "password": "密码",
    "role": "用户角色(student/admin)"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "user": {
        "userId": 1,
        "studentId": "20210001",
        "role": "student"
      }
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.1.2 OSS文件上传

- 接口路径：`POST /api/public/oss/upload`

- 请求参数：

  - file: 文件二进制数据

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "上传成功",
    "url": "https://aethernet.oss-cn-hangzhou.aliyuncs.com/images/20230501/xxx.jpg",
    "timestamp": 1623456789000
  }
  ```

#### 3.1.3 界面筛选相关接口

##### 获取分类列表

- 接口路径：`GET /api/public/categories`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {"categoryId": 1, "categoryName": "二手交易", "categoryCode": "secondhand"},
      {"categoryId": 2, "categoryName": "代拿服务", "categoryCode": "delivery"},
      {"categoryId": 3, "categoryName": "拼车出行", "categoryCode": "carpool"},
      {"categoryId": 4, "categoryName": "其他", "categoryCode": "others"}
    ],
    "timestamp": 1623456789000
  }
  ```

##### 获取标签列表

- 接口路径：`GET /api/public/tags`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 2,
      "totalPages": 1,
      "records": [
        {"tagId": 1, "tagName": "二手书籍", "postCount": 25},
        {"tagId": 2, "tagName": "代取快递", "postCount": 18}
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 根据标签名查询标签

- 接口路径：`GET /api/public/tags/search`

- 请求参数：

  - tagName: 标签名称（支持模糊查询）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "tagId": 1,
      "tagName": "二手书籍",
      "postCount": 25,
      "createdAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

### 3.2 学生端接口（/api/student）

#### 3.2.1 用户信息类接口

##### 获取当前用户信息

- 接口路径：`GET /api/student/profile`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "userId": 1,
      "username": "张三",
      "studentId": "20210001",
      "email": "zhangsan@example.com",
      "phone": "13800138000",
      "role": "student",
      "status": 1,
      "avatarUrl": "https://example.com/avatar.jpg",
      "createdAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 修改个人信息

- 接口路径：`PUT /api/student/profile`

- 请求参数：

  ```json
  {
    "avatarUrl": "头像链接",
    "phone": "手机号",
    "email": "邮箱"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "修改成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

#### 3.2.2 创建标签

- 接口路径：`POST /api/student/tags`

- 请求参数：

  ```json
  {
    "tagName": "标签名称"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "创建成功",
    "data": {
      "tagId": 1,
      "tagName": "新标签"
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.2.3 帖子相关接口

##### 发布帖子

- 接口路径：`POST /api/student/posts`

- 请求参数：

  ```json
  {
    "title": "帖子标题",
    "content": "帖子内容",
    "categoryId": 1,                    // 分类ID
    "tagNames": ["新标签1", "新标签2"],   // 新标签名称数组（可选，用于创建新标签）
    
    "images": ["图片链接1", "图片链接2"],  // 图片链接数组
    "isAnonymous": 0,
    "location": "地点信息",
    "contactInfo": "联系方式"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "发布成功",
    "data": {
      "postId": 1
    },
    "timestamp": 1623456789000
  }
  ```

> 注意：如果提供了 tagName，则后台会先创建这些新标签，再关联到帖子上。如果提供了 tagId，则直接关联已有标签。

##### ai生成帖子

- 接口路径：`POST /api/student/posts/generate`

- 请求参数：

  ```json
  {
    "prompt": "写一篇关于大学生如何高效学习的建议"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "msg": "success",
    "data": {
      "title": "大学生高效学习的五大实用建议",
      "content": "1. 制定计划... 2. 主动复习...",
      "categoryId": 3,
      "tagNames": ["学习方法", "效率提升", "AI生成"]
    }
  }
  ```

##### 编辑帖子

- 接口路径：`PUT /api/student/posts/{postId}`

- 请求参数：

  ```json
  {
    "title": "帖子标题",
    "content": "帖子内容",
    "categoryId": 1,                    // 分类ID
    "tagIds": [1, 2, 3],                // 标签ID数组（推荐）
    "tagNames": ["新标签1", "新标签2"],   // 新标签名称数组（可选，用于创建新标签）
    "images": ["图片链接1", "图片链接2"],  // 图片链接数组
    "location": "地点信息",
    "contactInfo": "联系方式"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "修改成功",
    "data": {
      "postId": 1
    },
    "timestamp": 1623456789000
  }
  ```

> 注意：如果提供了 tagName，则后台会先创建这些新标签，再关联到帖子上。如果提供了 tagId，则直接关联已有标签。

##### 获取帖子列表

- 接口路径：`GET /api/student/posts`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - categoryId: 分类筛选（可选）
  - tagId: 标签筛选（可选）
  - keyword: 搜索关键词（可选）
  - sortBy: 排序字段（createdAt/viewCount/likeCount，默认createdAt）
  - order: 排序方式（asc/desc，默认desc）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 100,
      "totalPages": 10,
      "records": [
        {
          "postId": 1,
          "title": "出售MacBook Pro",
          "content": "2020款MacBook Pro，9成新...",
          "category": {
            "categoryId": 1,
            "categoryName": "二手交易"
          },
          "author": "张三",
          "avatarUrl": "www.cnhiwhiawdhiwdi.cn",
          "viewCount": 128,
          "likeCount": 15,
          "commentCount": 8,
          "isTop": 0,
          "isFeatured": 0,
          "tags": ["电子产品", "笔记本"],
          "images": ["https://example.com/image1.jpg", "https://example.com/image2.jpg"],
          "location": "图书馆附近",
          "createdAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": true
    },
    "timestamp": 1623456789000
  }
  ```

##### 获取帖子详情

- 接口路径：`GET /api/student/posts/{postId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "postId": 1,
      "title": "出售MacBook Pro",
      "content": "2020款MacBook Pro，9成新...",
      "category": {
        "categoryId": 1,
        "categoryName": "二手交易"
      },
      "author": {
        "userId": 2,
        "username": "huhuhu",
        "studentId": "20210002",
        "avatarUrl": "https://example.com/avatar.jpg"
      },
      "viewCount": 128,
      "likeCount": 15,
      "commentCount": 8,
      "isLiked": true,
      "isFavorited": true,
      "tags": ["电子产品", "笔记本"],
      "images": ["https://example.com/image1.jpg", "https://example.com/image2.jpg"],
      "location": "图书馆附近",
      "contactInfo": "电话：13800138000",
      "createdAt": "2023-05-01T10:00:00Z",
      "updatedAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 删除自己的帖子

- 接口路径：`DELETE /api/student/posts/{postId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "删除成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```



##### 获取帖子评论列表

- 接口路径：`GET /api/student/posts/{postId}/comments`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - sortBy: 排序字段（createdAt/likeCount，默认createdAt）
  - order: 排序方式（asc/desc，默认desc）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 25,
      "totalPages": 3,
      "records": [
        {
          "commentId": 1,
          "postId": 1,
          "parentId": 0,
          "content": "这个多少钱？",
          "user": {
            "userId": 3,
            "username": "李四",
            "avatarUrl": "https://example.com/avatar2.jpg"
          },
          "likeCount": 2,
          "isLiked": false,
          "replyCount": 3,
          "createdAt": "2023-05-01T11:00:00Z"
        },
        {
          "commentId": 4,
          "postId": 1,
          "parentId": 0,
          "content": "看起来不错",
          "user": {
            "userId": 6,
            "username": "孙七",
            "avatarUrl": "https://example.com/avatar5.jpg"
          },
          "likeCount": 1,
          "isLiked": false,
          "replyCount": 0,
          "createdAt": "2023-05-01T11:30:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": true
    },
    "timestamp": 1623456789000
  }
  ```

##### 获取评论的直接回复列表

- 接口路径：`GET /api/student/comments/{commentId}/replies`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - sortBy: 排序字段（createdAt/likeCount，默认createdAt）
  - order: 排序方式（asc/desc，默认asc，按时间正序排列）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 3,
      "totalPages": 1,
      "records": [
        {
          "commentId": 2,
          "postId": 1,
          "parentId": 1,
          "content": "8000元",
          "user": {
            "userId": 2,
            "username": "张三",
            "avatarUrl": "https://example.com/avatar.jpg"
          },
          "likeCount": 1,
          "isLiked": false,
          "replyCount": 1,
          "createdAt": "2023-05-01T11:05:00Z"
        },
        {
          "commentId": 7,
          "postId": 1,
          "parentId": 1,
          "content": "我也想知道价格",
          "user": {
            "userId": 8,
            "username": "周八",
            "avatarUrl": "https://example.com/avatar6.jpg"
          },
          "likeCount": 0,
          "isLiked": false,
          "replyCount": 0,
          "createdAt": "2023-05-01T11:35:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 发布评论

- 接口路径：`POST /api/student/comments`

- 请求参数：

  ```json
  {
    "postId": 1,
    "content": "评论内容",
    "parentId": 0  // 回复评论时指定被回复的评论ID，直接评论帖子时传0或不传
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "评论成功",
    "data": {
      "commentId": 1
    },
    "timestamp": 1623456789000
  }
  ```

##### 删除自己的评论

- 接口路径：`DELETE /api/student/comments/{commentId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "删除成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 点赞/取消点赞帖子

- 接口路径：`POST /api/student/posts/{postId}/like`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "isLiked": true,  // 当前是否已点赞
      "likeCount": 16   // 点赞总数
    },
    "timestamp": 1623456789000
  }
  ```

##### 收藏/取消收藏帖子

- 接口路径：`POST /api/student/posts/{postId}/favorite`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "isFavorited": true  // 当前是否已收藏
    },
    "timestamp": 1623456789000
  }
  ```

##### 点赞/取消点赞评论

- 接口路径：`POST /api/student/comments/{commentId}/like`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {
      "isLiked": true,  // 当前是否已点赞
      "likeCount": 3   // 点赞总数
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.2.4 任务相关接口

##### 发布任务

- 接口路径：`POST /api/student/tasks`

- 请求参数：

  ```json
  {
    "title": "任务标题",
    "description": "任务描述",
    "reward": 10.00,     // 酬劳金额
    "deadline": "2023-05-10T18:00:00Z",  // 截止时间
    "location": "地点信息",
    "contactInfo": "联系方式"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "发布成功",
    "data": {
      "taskId": 1
    },
    "timestamp": 1623456789000
  }
  ```

获取任务列表

- 接口路径：`GET /api/student/tasks`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - status: 状态筛选（可选）
  - minReward: 最小酬劳（可选）
  - maxReward: 最大酬劳（可选）
  - keyword: 搜索关键词（可选）
  - sortBy: 排序字段（createdAt/deadline/reward，默认createdAt）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 25,
      "totalPages": 3,
      "records": [
        {
          "taskId": 1,
          "title": "代取快递",
          "description": "帮我取一下快递，送到宿舍楼下",
          "publisher": "李四",
          "reward": 5.00,
          "status": "open",
          "location": "第一宿舍楼",
          "deadline": "2023-05-10T18:00:00Z",
          "createdAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": true
    },
    "timestamp": 1623456789000
  }
  ```

##### 获取任务详情

- 接口路径：`GET /api/student/tasks/{taskId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "taskId": 1,
      "title": "代取快递",
      "description": "帮我取一下快递，送到宿舍楼下",
      "publisher": {
        "userId": 2,
        "username": "李四",
        "avatarUrl": "https://example.com/avatar.jpg"
      },
      "assignee": null,
      "reward": 5.00,
      "status": "open",
      "location": "第一宿舍楼",
      "contactInfo": "电话：13800138000",
      "deadline": "2023-05-10T18:00:00Z",
      "createdAt": "2023-05-01T10:00:00Z",
      "updatedAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 接受任务

- 接口路径：`POST /api/student/tasks/{taskId}/accept`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "接单成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 完成任务

- 接口路径：`POST /api/student/tasks/{taskId}/complete`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "任务完成",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 取消任务

- 接口路径：`POST /api/student/tasks/{taskId}/cancel`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "任务已取消",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 删除任务

- 接口路径：`DELETE /api/student/tasks/{taskId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "删除成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

#### 3.2.5 举报相关接口

##### 举报帖子

- 接口路径：`POST /api/student/posts/{postId}/report`

- 请求参数：

  ```json
  {
    "reason": "举报原因"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "举报成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 举报评论

- 接口路径：`POST /api/student/comments/{commentId}/report`

- 请求参数：

  ```json
  {
    "reason": "举报原因"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "举报成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

#### 3.2.6 收藏相关接口

##### 获取我的收藏列表

- 接口路径：`GET /api/student/favorites`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 5,
      "totalPages": 1,
      "records": [
        {
          "favoriteId": 1,
          "postId": 10,
          "postTitle": "出售iPhone 12",
          "postAuthor": "王五",
          "createdAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 取消收藏帖子

- 接口路径：`DELETE /api/student/favorites/{favoriteId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "取消收藏成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

### 3.3 管理员接口（/api/admin）

#### 3.3.1 管理用户相关接口

##### 获取用户列表

- 接口路径：`GET /api/admin/users`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - status: 状态筛选（可选）
  - role: 用户角色筛选（可选）
  - keyword：关键词筛选

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 100,
      "totalPages": 10,
      "records": [
        {
          "userId": 1,
          "username": "张三",
          "studentId": "20210001",
          "email": "zhangsan@example.com",
          "phone": "13800138000",
          "role": "student",
          "status": 1,
          "createdAt": "2023-05-01T10:00:00Z",
          "updatedAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": true
    },
    "timestamp": 1623456789000
  }
  ```

##### 禁用/启用用户

- 接口路径：`PUT /api/admin/users/{userId}/status`

- 请求参数：

  ```json
  {
    "status": 0  // 0禁用，1启用
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 查看用户详细信息

- 接口路径：`GET /api/admin/users/{userId}`

- 请求参数：

  - 无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "userId": 1,
      "username": "张三",
      "studentId": "20210001",
      "email": "zhangsan@example.com",
      "phone": "13800138000",
      "role": "student",
      "status": 1,
      "avatarUrl": "https://example.com/avatar.jpg",
      "createdAt": "2023-05-01T10:00:00Z",
      "updatedAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 新增管理员

- 接口路径：`POST /api/admin/users/admin`

- 请求参数：

  ```json
  {
    "username": "管理员名称",
    "password": "密码",
    "phone": "手机号"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "管理员创建成功",
    "data": {
      "userId": 1,
      "username": "管理员名称",
      "phone": "13800138000",
      "role": "admin",
      "status": 1
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.3.2 管理帖子相关接口

##### 获取待审核帖子列表

- 接口路径：`GET /api/admin/posts/pending`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 5,
      "totalPages": 1,
      "records": [
        {
          "postId": 1,
          "title": "出售MacBook Pro",
          "content": "内容...",
          "author": "张三",
          "category": {
            "categoryId": 1,
            "categoryName": "二手交易"
          },
          "createdAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 审核帖子

- 接口路径：`PUT /api/admin/posts/{postId}/moderate`

- 请求参数：

  ```json
  {
    "decision": "approved",     // 审核决定，可选值: "approved"(通过), "rejected"(拒绝)
    "riskLevel": "low",        // 风险等级，可选值: "low"(低风险), "medium"(中风险), "high"(高风险)
    "reason": "审核备注"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "审核成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 置顶/取消置顶帖子

- 接口路径：`PUT /api/admin/posts/{postId}/top`

- 请求参数：

  ```json
  {
    "isTop": 1  // 1置顶，0取消置顶
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

##### 设置/取消精华帖

- 接口路径：`PUT /api/admin/posts/{postId}/featured`

- 请求参数：

  ```json
  {
    "isFeatured": 1  // 1设为精华帖，0取消精华帖
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

#### 3.3.3 获取审核日志

- 接口路径：`GET /api/admin/moderation/logs`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - moderatorId: 审核员筛选（可选）
  - startDate: 开始日期（可选）
  - endDate: 结束日期（可选）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 50,
      "totalPages": 5,
      "records": [
        {
          "logId": 1,
          "postTitle": "出售MacBook Pro",
          "moderator": "管理员",
          "decision": "approved",
          "riskLevel": "low",
          "reason": "内容合规",
          "createdAt": "2023-05-01T11:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": true
    },
    "timestamp": 1623456789000
  }
  ```

#### 3.3.4 管理举报相关接口

##### 获取举报列表

- 接口路径：`GET /api/admin/reports`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - status: 状态筛选（可选）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 5,
      "totalPages": 1,
      "records": [
        {
          "reportId": 1,
          "reporter": "王五",
          "targetType": "post",
          "targetTitle": "违规广告",
          "reason": "涉嫌虚假宣传",
          "status": "pending",
          "createdAt": "2023-05-01T12:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 处理举报

- 接口路径：`PUT /api/admin/reports/{reportId}/handle`

- 请求参数：

  ```json
  {
    "status": "processed",  // 处理结果：processed（已处理）、dismissed（已驳回）
    "remark": "处理备注"
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "处理成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

#### 3.3.5 获取系统统计信息

- 接口路径：`GET /api/admin/statistics`

- 请求参数：无

- 响应示例：

  
#### 3.3.6 管理分类相关接口

##### 管理员获取分类列表

- 接口路径：`GET /api/admin/categories`

- 请求参数：

  - page: 页码（默认1）
  - size: 每页条数（默认10）
  - keyword: 关键词搜索（可选）

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "currentPage": 1,
      "pageSize": 10,
      "total": 4,
      "totalPages": 1,
      "records": [
        {
          "categoryId": 1,
          "categoryName": "二手交易",
          "categoryCode": "secondhand",
          "sortOrder": 1,
          "createdAt": "2023-05-01T10:00:00Z"
        },
        {
          "categoryId": 2,
          "categoryName": "代拿服务",
          "categoryCode": "delivery",
          "sortOrder": 2,
          "createdAt": "2023-05-01T10:00:00Z"
        }
      ],
      "hasPrevious": false,
      "hasNext": false
    },
    "timestamp": 1623456789000
  }
  ```

##### 获取分类详情

- 接口路径：`GET /api/admin/categories/{categoryId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "categoryId": 1,
      "categoryName": "二手交易",
      "categoryCode": "secondhand",
      "sortOrder": 1,
      "createdAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 新增分类

- 接口路径：`POST /api/admin/categories`

- 请求参数：

  ```json
  {
    "categoryName": "分类名称",
    "categoryCode": "分类代码",
    "sortOrder": 0
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "新增成功",
    "data": {
      "categoryId": 5,
      "categoryName": "新分类",
      "categoryCode": "new_category",
      "sortOrder": 0,
      "createdAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 修改分类

- 接口路径：`PUT /api/admin/categories/{categoryId}`

- 请求参数：

  ```json
  {
    "categoryName": "分类名称",
    "categoryCode": "分类代码",
    "sortOrder": 0
  }
  ```

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "修改成功",
    "data": {
      "categoryId": 5,
      "categoryName": "修改后的分类名称",
      "categoryCode": "modified_category",
      "sortOrder": 1,
      "createdAt": "2023-05-01T10:00:00Z"
    },
    "timestamp": 1623456789000
  }
  ```

##### 删除分类

- 接口路径：`DELETE /api/admin/categories/{categoryId}`

- 请求参数：无

- 响应示例：

  ```json
  {
    "code": 200,
    "message": "删除成功",
    "data": null,
    "timestamp": 1623456789000
  }
  ```

